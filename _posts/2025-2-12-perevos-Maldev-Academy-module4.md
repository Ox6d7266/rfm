---
layout: post
title: "Модуль 4 MalDev Academy на русском"
---

**Модуль 4 DLL**

![]({{ site.baseurl }}/images/m34.jpg)

Итак Илита! Часть про DLL и их роль в Малдвеве крайне коряво написана в оригинале. 
Так что я взял на себя смелость внести кучу правок и изменить модуль. Это никак не связано с конфликтом малварь академи со мной. 
Я бы поступил точно так же и если бы они репостнули мои переводы к себе. 
К теме. 
DLL (Dynamic Link Library) — это библиотеки динамической компоновки, которые содержат код и данные, используемые несколькими программами одновременно. Они играют важную роль в Windows и других операционных системах, обеспечивая модульность и повторное использование кода. Однако DLL также могут быть использованы для вредоносных целей.

***DLL в анализе вредоносного ПО***

 - Загрузка DLL: Вредоносное ПО может загружать DLL для выполнения вредоносных действий. Анализ загруженных DLL может помочь выявить вредоносную активность.
 - Внедрение DLL: Вредоносное ПО может внедрять DLL в легитимные процессы для выполнения вредоносного кода под видом доверенного процесса.
 - Маскировка: Вредоносное ПО может маскироваться под легитимные DLL, чтобы избежать обнаружения.

***DLL в разработке***

 - Модульность: DLL позволяют разделять код на модули, что упрощает разработку и поддержку программного обеспечения.
 - Повторное использование кода: DLL позволяют повторно использовать код в разных программах, что уменьшает размер программ и экономит ресурсы.
 - Расширяемость: DLL позволяют расширять функциональность программ без необходимости перекомпиляции всего кода.

***Инструменты для анализа DLL***

 - Dependency Walker: Показывает зависимости DLL и помогает выявить отсутствующие или поврежденные DLL.
 - Process Explorer: Показывает загруженные DLL в каждом процессе и позволяет выявить подозрительные DLL.
 - IDA Pro: Мощный инструмент для дизассемблирования и анализа DLL.

***Пример создания DLL с помощью Visual Studio***
Разберем по шагам: 
Шаг 1 создание проекта DLL

 -Откройте Visual Studio и создайте новый проект.
 - В окне создания проекта выберите "Dynamic-Link Library (DLL)".
 - Укажите имя проекта (например, MyDLL) и местоположение.

Шаг 2 Написание кода DLL

 - Откройте файл MyDLL.cpp.
 - Добавьте следующий код(это просто пример):

   
```
#include "pch.h"

#define MYDLL_API __declspec(dllexport) // Макрос для экспорта

// Функция, которая будет экспортироваться из DLL
extern "C" MYDLL_API int Add(int a, int b) {
  return a + b;
}

// Функция, которая также будет экспортироваться из DLL
extern "C" MYDLL_API int Subtract(int a, int b) {
  return a - b;
}
```

 - В этом примере мы создали две функции: `Add` и `Subtract`, которые складывают и вычитают два числа соответственно.
 - `extern "C"` обеспечивает совместимость с другими языками программирования.
 - `MYDLL_API` - это макрос, который указывает, что функция должна быть экспортирована из DLL.

Шаг 3 Сборка DLL
 
 - В меню "Сборка" выберите "Собрать решение".
 - Visual Studio создаст DLL-файл (MyDLL.dll) в каталоге проекта.

Шаг 4 использование DLL в другом проекте

 - Создайте новый проект (например, консольное приложение).
 - Добавьте в проект ссылку на DLL:
1. Щелкните правой кнопкой мыши по проекту в обозревателе решений.
2. Выберите "Добавить" -> "Ссылка...".
3. В открывшемся окне перейдите на вкладку "Обзор" и выберите файл MyDLL.dll.
 - Добавьте следующий код в файл main.cpp:

```
#include <iostream>
extern "C" int Add(int a, int b);
extern "C" int Subtract(int a, int b);

int main() {
  int x = 5;
  int y = 3;
  int sum = Add(x, y);
  int difference = Subtract(x, y);

  std::cout << "Сумма: " << sum << std::endl;
  std::cout << "Разность: " << difference << std::endl;

  return 0;
}
```

 - Запустите приложение. Оно выведет на экран результаты сложения и вычитания, используя функции из DLL.


***Важные моменты:***

 - Заголовочный файл: Для удобства использования функций из DLL рекомендуется создать заголовочный файл (например, MyDLL.h), в котором объявить прототипы функций.
 - Соглашения о вызовах: При создании DLL необходимо учитывать соглашения о вызовах, которые определяют порядок передачи параметров в функцию.
 - Разрядность: DLL и приложение, использующее ее, должны иметь одинаковую разрядность (32-разрядные или 64-разрядные).

***Домашнее задание на создание DLL с инжектом: "Монитор процессов"***

Цель: Создать DLL, которая предоставляет две функции:

 - Получение списка запущенных процессов.
 - Инжект DLL в указанный процесс и выполнение заданной функции.

Требования:

 - DLL должна быть написана на языке C++ с использованием Visual Studio.
 - Функции должны быть объявлены с использованием `__declspec(dllexport)`, чтобы быть доступными из других программ.
 - Функции должны корректно обрабатывать входные данные и возвращать корректные результаты.
 - DLL должна быть протестирована с помощью простой программы, которая вызывает эти функции и выводит результаты на экран.

Рекомендую использовать и изучить:

 - Для успешного выполнения задания рекомендуется ознакомиться с документацией по функциям WinAPI, используемым для работы с процессами и внедрения DLL.
 - При реализации функций необходимо учитывать возможные ошибки (например, неверный PID, отсутствие прав доступа к процессу) и корректно их обрабатывать.
 - Для тестирования DLL можно создать простое консольное приложение, которое будет вызывать функции из DLL и выводить результаты на экран.

Если не получится справится, ничего страшного. Со временем вернетесь к нему. 

![]({{ site.baseurl }}/images/m35.jpg)

Понравилось? Подпишись https://t.me/l33trfm0x

